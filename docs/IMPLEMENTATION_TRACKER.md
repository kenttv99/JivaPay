# Трекер Реализации Backend

Этот документ помогает отслеживать, что уже сделано в бэкенде, а что еще предстоит реализовать.

Статус задач:
- [ ] Не начато
- [x] Готово
- [/] В процессе

Для каждой задачи можно добавить комментарии, ссылки на PR или коммиты.

---

## 1. Настройка Проекта

- [x] **Создание Структуры Проекта**: Создали основные папки `backend/services/`, `backend/utils/`, `backend/worker/`.
- [x] **Настройка Конфигурации**:
    - [x] Настроили работу с переменными окружения через `.env` и `pydantic-settings`.
      - Примечание: Используем Pydantic Settings в `backend/config/settings.py`. Важное исправление от 10.05.2025: Синхронизировали `.env` и `docker-compose.yml` для корректной работы с базой данных.
    - [x] Создали модель `ConfigurationSetting` для хранения настроек в БД.
    - [x] Написали утилиту для чтения настроек из БД.
    - [x] Создали скрипт для заполнения начальных настроек.
      - Примечание: Теперь это часть скрипта `backend/scripts/manage_db.py` (команда seed-config).
- [x] **Модели Базы Данных**:
    - [x] Создали базовую структуру моделей в `db.py`.
    - [x] Добавили модель `ConfigurationSetting`.
    - [x] Добавили основные модели (`User`, `Order` и др.).
    - [x] Добавили модель `TeamLead` и связь с `Trader`.
    - [x] Добавили новые поля для трейдеров и саппортов.
    - [x] Создали модель `PaymentSession` для работы с платежными страницами.

## 2. Аутентификация

- [x] **JWT и OAuth2**:
    - [x] Настроили генерацию и проверку токенов.
    - [x] Добавили хеширование паролей.
    - [x] Настроили FastAPI Security.
- [x] **Эндпоинты для Входа**:
    - [x] `/merchant/auth/token` для мерчантов.
    - [x] `/trader/auth/token` для трейдеров.
    - [x] `/support/auth/login` для саппортов.
- [x] **Защита API**: Добавили проверку токенов для всех защищенных эндпоинтов.

## 3. Основные Сервисы

- [x] **Работа с БД**:
    - [x] Написали утилиты для безопасной работы с БД.
    - [x] Добавили асинхронные версии для работы с БД.
- [x] **Управление Пользователями**:
    - [x] Реализовали создание и аутентификацию пользователей.
    - [x] Добавили поддержку ролей Support и TeamLead.
- [x] **Подбор Реквизитов**:
    - [x] Написали логику поиска подходящих реквизитов.
    - [x] Добавили проверку активности трейдеров.
- [x] **Обработка Заказов**:
    - [x] Реализовали создание и обработку заказов.
    - [x] Добавили проверку на мошенничество.
    - [x] Настроили работу с чеками.
- [x] **Управление Балансами**:
    - [x] Реализовали обновление балансов.
    - [x] Добавили историю операций.
- [x] **Справочные Данные**:
    - [x] Настроили кэширование в Redis.
    - [x] Добавили работу с курсами валют.
- [x] **Платежный Шлюз**:
    - [x] Реализовали создание платежных сессий.
    - [x] Добавили обработку подтверждений.
    - [x] Настроили отправку уведомлений мерчантам.

## 4. Утилиты

- [x] **Работа с Конфигурацией**:
    - [x] Написали утилиты для чтения настроек.
    - [x] Добавили кэширование.
- [x] **Обработка Ошибок**:
    - [x] Создали систему исключений.
    - [x] Настроили глобальные обработчики.
- [x] **Уведомления**:
    - [x] Настроили отправку в Sentry.
- [x] **Работа с Запросами**:
    - [x] Добавили утилиты для пагинации и сортировки.
    - [x] Написали фильтры для запросов.

## 5. API

- [x] **Аутентификация**:
    - [x] Настроили эндпоинты для входа.
- [x] **Мерчанты**:
    - [x] Добавили управление заказами и магазинами.
- [x] **Трейдеры**:
    - [x] Реализовали работу с заказами.
- [x] **Саппорт**:
    - [x] Добавили просмотр статистики.
- [x] **Администраторы**:
    - [x] Реализовали полное управление системой.
- [x] **Публичные Эндпоинты**:
    - [x] Добавили доступ к справочным данным.
- [x] **Платежный Шлюз**:
    - [x] Настроили работу с платежными сессиями.

## 6. Фоновые Задачи

- [x] **Настройка Celery**:
    - [x] Настроили очереди и воркеры.
- [ ] **Обработка Заказов**:
    - [ ] Добавить проверку идемпотентности.
    - [ ] Реализовать подбор реквизитов.
    - [ ] Настроить обновление статусов.
- [ ] **Обновление Балансов**:
    - [ ] Настроить асинхронные обновления.
- [ ] **Очереди**:
    - [ ] Настроить обработку ошибок.

## 7. Middleware

- [x] **Логирование**:
    - [x] Настроили запись запросов.
- [x] **Обработка Ошибок**:
    - [x] Добавили глобальные обработчики.
- [x] **Ограничение Запросов**:
    - [x] Настроили rate limiting через Redis.

## 8. Тестирование

- [ ] **Модульные Тесты**:
    - [ ] Написать тесты для сервисов.
- [ ] **Интеграционные Тесты**:
    - [ ] Протестировать взаимодействие компонентов.
- [ ] **Производительность**:
    - [ ] Проверить индексы БД.

## 9. Развертывание

- [x] **Docker**:
    - [x] Настроили контейнеры.
- [x] **Docker Compose**:
    - [x] Настроили локальную разработку.
- [x] **CI/CD**:
    - [x] Настроили автоматические тесты.
- [ ] **Мониторинг**:
    - [ ] Настроить Prometheus/Grafana.
- [ ] **Развертывание**:
    - [ ] Настроить blue-green деплой.

## 10. Серверы

- [x] Добавили сервер для тимлидов.

## 11. Модели Данных

- [x] Добавили поддержку платежных сессий.