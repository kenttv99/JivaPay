# Документация по компонентам backend (кроме таблиц БД)

---

## 1. Общая структура

Директория `backend` реализует серверную логику для различных ролей (мерчант, трейдер, саппорт, админ) и содержит вспомогательные модули для работы с БД, логированием, криптографией, конфигами и API-роутерами.

---

## 2. Компоненты

### 2.1. `database/`

- **engine.py**  
  Инициализация SQLAlchemy engine и сессии.  
  Использует переменные окружения для подключения к PostgreSQL.  
  Экспортирует:  
  - `engine` — основной объект подключения к БД  
  - `SessionLocal` — фабрика сессий SQLAlchemy

- **migrations/**  
  Скрипты Alembic для миграций схемы БД.  
  Основные функции: `upgrade()`, `downgrade()`, запуск offline/online миграций.

- **__init__.py**  
  Пустой, для обозначения пакета.

### 2.2. `config/`

- **logger.py**  
  Универсальный логгер с поддержкой вывода в консоль и файл (через RotatingFileHandler).  
  Формат логов и уровень задаются через .env.  
  Основная функция:  
  - `get_logger(name, log_file, level)` — возвращает настроенный логгер.

- **crypto.py**  
  Функции для безопасного хеширования и проверки паролей с использованием bcrypt.  
  - `hash_password(password)` — возвращает bcrypt-хеш пароля.  
  - `verify_password(password, hashed_password)` — проверяет соответствие пароля хешу.

- **__init__.py**  
  Пустой, для обозначения пакета.

### 2.3. `servers/`

Каждая поддиректория реализует FastAPI-приложение для своей роли:

- **trader/server.py**  
  FastAPI-приложение для трейдеров.  
  Подключает роутер аутентификации трейдера (`/trader/auth/login`).

- **merchant/server.py**  
  FastAPI-приложение для мерчантов.  
  Подключает роутер аутентификации мерчанта (`/merchant/auth/login`).

- **support/server.py**  
  FastAPI-приложение для саппорта.  
  Подключает роутер аутентификации саппорта (`/support/auth/login`).

- **admin/server.py**  
  FastAPI-приложение для админов.  
  Подключает роутер регистрации мерчанта и саппорта (`/admin/register/merchant`, `/admin/register/support`).

### 2.4. `api_routers/`

- **trader/auth.py**  
  Роутер FastAPI для аутентификации трейдера.  
  - POST `/trader/auth/login` — логин по email и паролю.

- **merchant/auth.py**  
  Роутер FastAPI для аутентификации мерчанта.  
  - POST `/merchant/auth/login` — логин по email и паролю.

- **support/auth.py**  
  Роутер FastAPI для аутентификации саппорта.  
  - POST `/support/auth/login` — логин по email и паролю.

- **admin/register.py**  
  Роутер FastAPI для регистрации новых мерчантов и саппортов.  
  - POST `/admin/register/merchant` — регистрация мерчанта.  
  - POST `/admin/register/support` — регистрация саппорта.

### 2.5. `shemas_enums/`

- **Назначение:**  
  Содержит схемы (pydantic-модели) и перечисления для валидации и типизации данных, используемых в API.  
  (Подробности о содержимом не раскрыты, но по использованию — это схемы для FastAPI.)

---

## 3. Вспомогательные файлы

- **README_DB.md**  
  Подробная документация по структуре и логике работы с БД (уже рассмотрена отдельно).

- **__init__.py**  
  В каждой папке — для обозначения пакета.

---

## 4. Взаимодействие компонентов

- Каждый сервер (trader, merchant, support, admin) — отдельное FastAPI-приложение с собственным роутером.
- Все приложения используют общие модули для логирования, работы с БД и криптографии.
- API-роутеры реализуют основные точки входа для аутентификации и регистрации.
- Схемы и перечисления вынесены в отдельный модуль для переиспользования и типизации.

---

## 5. Базовые рекомендации для расширения документации

- Для каждого сервера и роутера описывать:
  - Назначение
  - Основные эндпоинты
  - Используемые зависимости (например, логгер, сессия БД)
- Для вспомогательных модулей (`config`, `database/engine.py`) — назначение, основные функции/классы, переменные окружения.
- Для схем и перечислений — список моделей, их поля и назначение.

---

**Эта структура — основа для дальнейшего детального описания каждого компонента по мере развития проекта.** 